name: Bootstrap MindTrail Android Repo

on:
  workflow_dispatch:

jobs:
  bootstrap:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Create Android project structure
        run: |
          mkdir -p app/src/main/java/com/mindtrail/app
          mkdir -p app/src/main/res
          mkdir -p gradle/wrapper
          mkdir -p .github/workflows
          mkdir -p docs

          cat > gradle/wrapper/gradle-wrapper.properties <<EOF
          distributionBase=GRADLE_USER_HOME
          distributionPath=wrapper/dists
          distributionUrl=https\://services.gradle.org/distributions/gradle-8.6-bin.zip
          zipStoreBase=GRADLE_USER_HOME
          zipStorePath=wrapper/dists
          EOF

          cat > gradlew <<EOF
          #!/usr/bin/env sh
          echo "Gradle wrapper placeholder"
          EOF

          cat > gradlew.bat <<EOF
          @echo off
          echo Gradle wrapper placeholder
          EOF

          chmod +x gradlew

          cat > settings.gradle <<EOF
          rootProject.name = "MindTrail"
          include(":app")
          EOF

          cat > build.gradle <<EOF
          buildscript {
              repositories {
                  google()
                  mavenCentral()
              }
          }
          allprojects {
              repositories {
                  google()
                  mavenCentral()
              }
          }
          EOF

          cat > app/build.gradle <<EOF
          plugins {
              id 'com.android.application'
              id 'org.jetbrains.kotlin.android'
          }

          android {
              namespace "com.mindtrail.app"
              compileSdk 34

              defaultConfig {
                  applicationId "com.mindtrail.app"
                  minSdk 24
                  targetSdk 34
                  versionCode 1
                  versionName "1.0.0"
              }
          }

          dependencies {
              implementation "androidx.core:core-ktx:1.12.0"
          }
          EOF

          cat > app/src/main/AndroidManifest.xml <<EOF
          <manifest xmlns:android="http://schemas.android.com/apk/res/android"
              package="com.mindtrail.app">

              <application android:label="MindTrail">
                  <activity android:name=".MainActivity">
                      <intent-filter>
                          <action android:name="android.intent.action.MAIN"/>
                          <category android:name="android.intent.category.LAUNCHER"/>
                      </intent-filter>
                  </activity>
              </application>

          </manifest>
          EOF

          cat > app/src/main/java/com/mindtrail/app/MainActivity.kt <<EOF
          package com.mindtrail.app

          import android.os.Bundle
          import androidx.activity.ComponentActivity

          class MainActivity : ComponentActivity() {
              override fun onCreate(savedInstanceState: Bundle?) {
                  super.onCreate(savedInstanceState)
              }
          }
          EOF

          cat > README.md <<EOF
          # MindTrail

          Visual Memory & Mood Journaling App

          - GitHub-first
          - Android Studio optional
          - CI-driven
          EOF

          cat > docs/roadmap.md <<EOF
          v1: Mood journaling
          v2: Analytics
          v3: Voice notes
          EOF

      - name: Commit generated project
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add .
          git commit -m "Bootstrap MindTrail Android project"
          git push
